# 機械種別データ配列化：本番移行手順

対象バージョンと同じコードがデプロイされていることを前提に、NAS 上のデータを配列形式へ揃える手順です。

---

## 1. 事前準備
- 本番データルート（例：`\\nas\project-data` または `/mnt/nas/project-data`）を確認。
- レポジトリに `scripts/migrate-machine-type.js` が存在することを確認。
- 念のため `work-instructions/` と `search-index.json` をスナップショット／コピーなどでバックアップ。

## 2. ドライラン（書き込み無し）
```bash
node scripts/migrate-machine-type.js --dry-run --target "<NAS上のdataディレクトリ>"
```
- 変換対象と結果をログで確認。問題がなければ本実行へ進む。

## 3. 本実行
```bash
node scripts/migrate-machine-type.js --target "<NAS上のdataディレクトリ>"
```
- 既定で `.bak` バックアップを同ディレクトリに生成。確認後に不要なら削除可能。
- `--no-backup` を付けるとバックアップを作らない（基本は付けない）。

## 4. 動作確認
1. 管理画面で既存図番の編集ページを開き、機械種別チェックが正しく表示されるか確認。
2. 編集→保存、新規登録→保存が成功するか確認。
3. 閲覧ページ／検索結果で機械種別表示が期待通りかチェック。

## 5. 後片付け
- `.bak` が不要になったら削除。
- 必要に応じて `search-index.json` の差分を確認し、Git 管理対象であれば反映。

---

### 補足
- スクリプトは `public/data` を基点とするため、`--target` に NAS 側の `data` パスを忘れず指定する。
- 本番実行前に最新コードをデプロイし、移行後はアプリを再起動する（キャッシュがあればクリア）。*** End Patch
