# 検査報告書機能追加構想

## 概要

品質管理対応として、作業手順詳細ページに検査報告書機能を追加する。タブ形式で検査報告書を作成・表示し、PDF化して保存する機能を実装する。

## 機能要件

### 1. 基本機能
- タブを押すと検査報告書が表示される
- 報告書フォーマットは未定（検討中）
- 数値などを入力し、確定すると、PDF化されて別フォルダに格納される
- ファイルには日付と担当者名が入る

### 2. 表示場所
- 作業手順詳細ページのタブ列に「検査報告書」タブを追加
- 既存タブ: 「作業手順」「関連図面」「加工アイデア」→ 新規追加: 「検査報告書」

## 技術的実現性 ✅

### 1. 実現可能な機能
- ✅ タブ追加: 既存のタブ構造に簡単に追加可能
- ✅ フォーム作成: React Hook Form + TypeScriptで実装
- ✅ PDF生成: jsPDF や react-pdf で実装可能
- ✅ ファイル保存: API経由でサーバーに保存

### 2. 推奨フォーマット案

#### A. シンプルな検査シート形式
```
┌─────────────────────────────────────┐
│ 検査報告書                          │
├─────────────────────────────────────┤
│ 図番: ABC-001                       │
│ 検査日: 2024-01-15                  │
│ 担当者: 田中太郎                    │
├─────────────────────────────────────┤
│ 検査項目                            │
│ □ 寸法検査                          │
│ □ 表面粗さ                          │
│ □ 真円度                            │
│ □ その他                            │
├─────────────────────────────────────┤
│ 測定値                              │
│ 項目1: ___ mm                       │
│ 項目2: ___ μm                       │
│ 項目3: ___ mm                       │
├─────────────────────────────────────┤
│ 判定: □合格 □不合格                 │
│ 備考: _____________________________ │
└─────────────────────────────────────┘
```

#### B. 詳細な検査レポート形式
```
┌─────────────────────────────────────┐
│ 品質検査報告書                      │
├─────────────────────────────────────┤
│ 基本情報                            │
│ ・図番: ABC-001                     │
│ ・製品名: 精密部品A                 │
│ ・検査日時: 2024-01-15 14:30       │
│ ・担当者: 田中太郎                  │
│ ・検査機: 三次元測定機              │
├─────────────────────────────────────┤
│ 検査結果                            │
│ ┌─────────┬─────────┬─────────┐     │
│ │ 項目    │ 測定値  │ 判定    │     │
│ ├─────────┼─────────┼─────────┤     │
│ │ 外径    │ 50.02   │ 合格    │     │
│ │ 内径    │ 30.01   │ 合格    │     │
│ │ 長さ    │ 100.05  │ 合格    │     │
│ └─────────┴─────────┴─────────┘     │
├─────────────────────────────────────┤
│ 総合判定: 合格                      │
│ 次回検査予定: 2024-02-15           │
└─────────────────────────────────────┘
```

## 実装計画

### 1. 必要なファイル構成
```
src/
├── components/
│   ├── InspectionReport.tsx          # 検査報告書コンポーネント
│   ├── InspectionForm.tsx            # 検査フォーム
│   └── InspectionPDF.tsx             # PDF生成コンポーネント
├── types/
│   └── inspection.ts                 # 検査関連の型定義
├── lib/
│   └── pdfGenerator.ts               # PDF生成ライブラリ
└── app/api/
    └── inspection/
        └── route.ts                  # 検査報告書API
```

### 2. データ構造案
```typescript
interface InspectionReport {
  id: string;
  drawingNumber: string;
  inspectionDate: string;
  inspector: string;
  machineType: string;
  measurements: {
    item: string;
    value: number;
    unit: string;
    tolerance: string;
    result: 'pass' | 'fail';
  }[];
  overallResult: 'pass' | 'fail';
  notes: string;
  nextInspectionDate?: string;
  attachments?: string[]; // 画像ファイル
}
```

### 3. 実装ステップ
1. **タブ追加**: WorkInstructionResults.tsxに「検査報告書」タブ追加
2. **フォーム作成**: 検査項目の入力フォーム
3. **PDF生成**: jsPDFでレポート生成
4. **ファイル保存**: 日付_担当者名.pdf形式で保存
5. **履歴表示**: 過去の検査報告書一覧表示

### 4. 推奨ライブラリ
```json
{
  "jspdf": "^2.5.1",           // PDF生成
  "react-hook-form": "^7.48.2", // フォーム管理
  "date-fns": "^2.30.0"        // 日付処理
}
```

## ファイル保存構造案

### 保存場所
```
public/data/
├── work-instructions/
│   └── drawing-{図番}/
│       ├── instruction.json
│       ├── images/
│       ├── videos/
│       └── inspection-reports/        # 新規追加
│           ├── 2024-01-15_田中太郎.pdf
│           ├── 2024-01-20_佐藤次郎.pdf
│           └── ...
```

### ファイル命名規則
- 形式: `YYYY-MM-DD_担当者名.pdf`
- 例: `2024-01-15_田中太郎.pdf`

## 検討事項

### 1. フォーマット選択
- [ ] シンプルな検査シート形式
- [ ] 詳細な検査レポート形式
- [ ] カスタムフォーマット

### 2. 検査項目設定
- [ ] 固定項目（寸法、表面粗さなど）
- [ ] カスタマイズ可能な項目
- [ ] 図面別の項目設定

### 3. 履歴管理
- [ ] 過去の報告書一覧表示
- [ ] 報告書の編集・削除機能
- [ ] 検索・フィルタリング機能

### 4. 権限管理
- [ ] 報告書作成権限
- [ ] 報告書閲覧権限
- [ ] 管理者権限

## 今後の検討項目

1. **フォーマット決定**: どの形式の報告書にするか
2. **検査項目**: 固定項目かカスタマイズ可能か
3. **保存場所**: どのフォルダに保存するか
4. **履歴管理**: 過去の報告書も表示するか
5. **権限設定**: 誰が作成・閲覧できるか

## 参考資料

- 既存のタブ構造: `src/components/WorkInstructionResults.tsx`
- ファイル保存API: `src/app/api/files/route.ts`
- 型定義: `src/lib/dataLoader.ts` 