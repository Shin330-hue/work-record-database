# ç®¡ç†ç”»é¢èªè¨¼æ©Ÿèƒ½å®Ÿè£…ã‚¬ã‚¤ãƒ‰

**ä½œæˆæ—¥**: 2025å¹´7æœˆ22æ—¥  
**æ›´æ–°æ—¥**: 2025å¹´7æœˆ23æ—¥  
**ä½œæˆè€…**: Claude Code  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å®Ÿè£…å®Œäº†  

---

## ğŸ“‹ æ¦‚è¦

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ä½œæ¥­è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç®¡ç†ç”»é¢ã«èªè¨¼æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚~~ç¾åœ¨ã€APIå´ã«ã¯èªè¨¼æ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã«å•é¡ŒãŒã‚ã‚‹ãŸã‚ã€å®Œå…¨ãªèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦æ©Ÿèƒ½ã—ã¦ã„ã¾ã›ã‚“ã€‚~~

### æ›´æ–°å†…å®¹ï¼ˆ2025å¹´7æœˆ23æ—¥ï¼‰
- è¤‡æ•°ä½œæ¥­å“¡ã§ã®ãƒ­ã‚°ã‚¤ãƒ³ã«å¯¾å¿œ
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã™ã‚‹æ–¹å¼ã«å¤‰æ›´
- ~~å®Ÿè£…è¨ˆç”»ã‚’å…·ä½“åŒ–~~ â†’ **åŸºæœ¬å®Ÿè£…å®Œäº†**
- ãƒ­ã‚°ã‚¤ãƒ³åè¡¨ç¤ºæ©Ÿèƒ½è¿½åŠ 
- ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æœŸé™æ©Ÿèƒ½è¿½åŠ ï¼ˆ2æ™‚é–“ï¼‰

---

## ğŸ” å®Ÿè£…çŠ¶æ³

### âœ… å®Ÿè£…æ¸ˆã¿ã®æ©Ÿèƒ½

1. **ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢** (`/admin/login`)
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
   - ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
   - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹

2. **èªè¨¼API** (`/api/admin/auth/login`)
   - å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆpasswords.jsonï¼‰ã¨ã®ç…§åˆ
   - è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ
   - ç’°å¢ƒå¤‰æ•°èªè¨¼ã¸ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

3. **èªè¨¼ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½**
   - `AdminAuthCheck`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚ˆã‚‹è‡ªå‹•ãƒã‚§ãƒƒã‚¯
   - æœªèªè¨¼æ™‚ã®è‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯ï¼ˆ2æ™‚é–“ï¼‰

4. **ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤º**
   - ç®¡ç†ç”»é¢ãƒˆãƒƒãƒ—ã«ãƒ­ã‚°ã‚¤ãƒ³åè¡¨ç¤º
   - ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³

5. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**
   - æœ€çµ‚ã‚¢ã‚¯ã‚»ã‚¹æ™‚åˆ»ã®è¨˜éŒ²
   - 2æ™‚é–“ã®æœ‰åŠ¹æœŸé™
   - æ“ä½œã”ã¨ã®è‡ªå‹•å»¶é•·

### âš ï¸ æœªå®Ÿè£…ãƒ»å°†æ¥ã®æ‹¡å¼µå€™è£œ

1. **APIå€‹åˆ¥èªè¨¼**
   - å„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã®èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ãƒã‚§ãƒƒã‚¯ã¯æœªå®Ÿè£…
   - ç¾åœ¨ã¯ç”»é¢ãƒ¬ãƒ™ãƒ«ã®èªè¨¼ã®ã¿ã§é‹ç”¨

2. **è¿½åŠ æ©Ÿèƒ½**
   - ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´æ©Ÿèƒ½
   - æ¨©é™ç®¡ç†ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãªã©ï¼‰

---

## ğŸ¯ å®Ÿè£…æ–¹é‡

### ã‚·ãƒ³ãƒ—ãƒ«ãªèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰

1. **è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼**
   - è¤‡æ•°ã®ä½œæ¥­å“¡ï¼ˆæ•°åç¨‹åº¦ï¼‰ãŒãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¤–éƒ¨JSONãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã¯localStorageã§ç°¡æ˜“å®Ÿè£…
   - JWTç­‰ã®è¤‡é›‘ãªä»•çµ„ã¿ã¯ä½¿ç”¨ã—ãªã„

2. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†æ–¹å¼**
   - **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«**: `public/data/auth/passwords.json`ã§ç®¡ç†
   - **ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼**: ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€åå‰ã€æœ‰åŠ¹/ç„¡åŠ¹ãƒ•ãƒ©ã‚°
   - **Gitç®¡ç†**: passwords.jsonã¯.gitignoreã«è¿½åŠ ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ï¼‰

3. **èªè¨¼ãƒ•ãƒ­ãƒ¼**
   - **åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚**: ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›
   - **èªè¨¼æˆåŠŸå¾Œ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’localStorageã«ä¿å­˜
   - **2å›ç›®ä»¥é™**: è‡ªå‹•çš„ã«èªè¨¼ï¼ˆå†å…¥åŠ›ä¸è¦ï¼‰
   - **ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ**: localStorageã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ã“ã¨ã§å®Ÿç¾

4. **å®Ÿè£…ã®å„ªå…ˆé †ä½**
   - Phase 1: æ—¢å­˜ã®å•é¡Œä¿®æ­£ + èªè¨¼åŸºç›¤æ•´å‚™ï¼ˆ1æ™‚é–“ï¼‰
   - Phase 2: ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢è¿½åŠ ï¼ˆ1.5æ™‚é–“ï¼‰
   - Phase 3: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆ1æ™‚é–“ï¼‰

---

## ğŸ® ä½¿ã„æ–¹

### ãƒ­ã‚°ã‚¤ãƒ³æ–¹æ³•
1. `/admin`ã«ã‚¢ã‚¯ã‚»ã‚¹
2. è‡ªå‹•çš„ã«`/admin/login`ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
3. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼špassword123ã€admin2025ï¼‰
4. ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸå¾Œã€ç®¡ç†ç”»é¢ã¸

### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`public/data/auth/passwords.json`
- å½¢å¼ï¼š
```json
{
  "id": "worker001",
  "password": "password123",
  "name": "ä½œæ¥­å“¡A",
  "enabled": true
}
```

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- **æœ‰åŠ¹æœŸé™**ï¼šæœ€çµ‚æ“ä½œã‹ã‚‰2æ™‚é–“
- **è‡ªå‹•å»¶é•·**ï¼šç”»é¢æ“ä½œã”ã¨ã«æœŸé™å»¶é•·
- **è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ**ï¼š2æ™‚é–“æ“ä½œãªã—ã§è‡ªå‹•çš„ã«ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸

---

## ğŸš€ å®Ÿè£…è©³ç´°

### Phase 1: æ—¢å­˜ã®å•é¡Œä¿®æ­£ + èªè¨¼åŸºç›¤æ•´å‚™ï¼ˆâœ…å®Œäº†ï¼‰

#### 1. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
`public/data/auth/passwords.json`ã‚’ä½œæˆï¼š
```json
{
  "passwords": [
    {
      "id": "worker001",
      "password": "password123",
      "name": "ä½œæ¥­å“¡A",
      "enabled": true
    },
    {
      "id": "worker002",
      "password": "password456",
      "name": "ä½œæ¥­å“¡B",
      "enabled": true
    }
  ]
}
```

#### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
`.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã§ä»¥ä¸‹ã‚’è¨­å®šï¼š
```env
ADMIN_ENABLED=true
# å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«èªè¨¼ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ä»¥ä¸‹ã‚’è¿½åŠ 
USE_FILE_AUTH=true
AUTH_FILE_PATH=./public/data/auth/passwords.json
```

#### 3. èªè¨¼ãƒã‚§ãƒƒã‚¯é–¢æ•°ã®æ”¹ä¿®
`src/app/api/admin/drawings/route.ts`ã®`checkAdminAuth`é–¢æ•°ã‚’æ”¹ä¿®ï¼š
```typescript
import fs from 'fs'
import path from 'path'

function checkAdminAuth(request: NextRequest): boolean {
  const adminEnabled = process.env.ADMIN_ENABLED === 'true'
  if (!adminEnabled) return false

  const authHeader = request.headers.get('authorization')
  if (!authHeader) return false

  const token = authHeader.replace('Bearer ', '')
  
  // å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«èªè¨¼ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
  if (process.env.USE_FILE_AUTH === 'true') {
    try {
      const authFilePath = path.join(process.cwd(), process.env.AUTH_FILE_PATH || '')
      const authData = JSON.parse(fs.readFileSync(authFilePath, 'utf-8'))
      
      return authData.passwords.some((user: any) => 
        user.password === token && user.enabled
      )
    } catch (error) {
      console.error('èªè¨¼ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error)
      return false
    }
  }
  
  // å¾“æ¥ã®ç’°å¢ƒå¤‰æ•°èªè¨¼
  return token === process.env.ADMIN_PASSWORD
}
```

#### 4. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®èªè¨¼ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ä½œæˆ
`src/lib/auth/client.ts`ã‚’ä½œæˆï¼š
```typescript
// èªè¨¼æƒ…å ±ã®å–å¾—
export function getAuthInfo() {
  const authData = localStorage.getItem('authData')
  return authData ? JSON.parse(authData) : null
}

// èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç”Ÿæˆã™ã‚‹å…±é€šé–¢æ•°
export function getAuthHeaders(): HeadersInit {
  const authInfo = getAuthInfo()
  return {
    'Authorization': `Bearer ${authInfo?.password || ''}`,
    'Content-Type': 'application/json'
  }
}

// FormDataç”¨ã®èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆContent-Typeãªã—ï¼‰
export function getAuthHeadersForFormData(): HeadersInit {
  const authInfo = getAuthInfo()
  return {
    'Authorization': `Bearer ${authInfo?.password || ''}`
  }
}
```

#### 5. ç·¨é›†ç”»é¢ã®ä¿®æ­£ç®‡æ‰€
- `src/app/admin/drawings/[id]/edit/page.tsx`
  - `handleSubmit`é–¢æ•°
  - `handleFileUpload`é–¢æ•°
  - `removePdfOrProgramFile`é–¢æ•°
  - ãã®ä»–ã®APIå‘¼ã³å‡ºã—éƒ¨åˆ†

### Phase 2: ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®è¿½åŠ ï¼ˆæ¨å¥¨ï¼‰

#### 1. ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã®ä½œæˆ
`src/app/admin/login/page.tsx`:
```typescript
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'

export default function AdminLogin() {
  const [password, setPassword] = useState('')
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(false)
  const router = useRouter()

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    setIsLoading(true)
    
    try {
      // èªè¨¼ç¢ºèª
      const response = await fetch('/api/admin/auth/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ password })
      })

      const data = await response.json()

      if (response.ok && data.success) {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’localStorageã«ä¿å­˜
        localStorage.setItem('authData', JSON.stringify({
          id: data.user.id,
          name: data.user.name,
          password: password,
          loginTime: new Date().toISOString()
        }))
        router.push('/admin')
      } else {
        setError('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“')
      }
    } catch (err) {
      setError('ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ')
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
      <div className="max-w-md w-full bg-white rounded-lg shadow p-8">
        <h1 className="text-2xl font-bold text-gray-900 mb-2">ç®¡ç†ç”»é¢ãƒ­ã‚°ã‚¤ãƒ³</h1>
        <p className="text-gray-600 mb-6">ä½œæ¥­è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
        
        <form onSubmit={handleLogin}>
          <div className="mb-4">
            <label className="block text-sm font-medium text-gray-700 mb-2">
              ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
            </label>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
              required
              disabled={isLoading}
            />
          </div>
          
          {error && (
            <div className="bg-red-50 text-red-700 px-3 py-2 rounded-md text-sm mb-4">
              {error}
            </div>
          )}
          
          <button
            type="submit"
            className="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
            disabled={isLoading}
          >
            {isLoading ? 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...' : 'ãƒ­ã‚°ã‚¤ãƒ³'}
          </button>
        </form>
      </div>
    </div>
  )
}
```

#### 2. ãƒ­ã‚°ã‚¤ãƒ³APIã®ä½œæˆ
`src/app/api/admin/auth/login/route.ts`:
```typescript
import { NextRequest, NextResponse } from 'next/server'
import fs from 'fs'
import path from 'path'

export async function POST(request: NextRequest) {
  try {
    const { password } = await request.json()
    
    if (!password) {
      return NextResponse.json(
        { error: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“' },
        { status: 400 }
      )
    }

    // å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«èªè¨¼
    if (process.env.USE_FILE_AUTH === 'true') {
      const authFilePath = path.join(process.cwd(), process.env.AUTH_FILE_PATH || '')
      const authData = JSON.parse(fs.readFileSync(authFilePath, 'utf-8'))
      
      const user = authData.passwords.find((u: any) => 
        u.password === password && u.enabled
      )
      
      if (user) {
        return NextResponse.json({
          success: true,
          user: {
            id: user.id,
            name: user.name
          }
        })
      }
    }
    
    // å¾“æ¥ã®ç’°å¢ƒå¤‰æ•°èªè¨¼
    if (password === process.env.ADMIN_PASSWORD) {
      return NextResponse.json({
        success: true,
        user: {
          id: 'admin',
          name: 'ç®¡ç†è€…'
        }
      })
    }
    
    return NextResponse.json(
      { error: 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ' },
      { status: 401 }
    )
  } catch (error) {
    console.error('Login error:', error)
    return NextResponse.json(
      { error: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' },
      { status: 500 }
    )
  }
}
```

### Phase 3: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

#### 1. èªè¨¼çŠ¶æ…‹ã®ç¢ºèªãƒ•ãƒƒã‚¯
`src/hooks/useAdminAuth.ts`:
```typescript
import { useEffect, useState } from 'react'
import { useRouter } from 'next/navigation'
import { getAuthInfo } from '@/lib/auth/client'

export function useAdminAuth() {
  const [isAuthenticated, setIsAuthenticated] = useState(false)
  const [loading, setLoading] = useState(true)
  const [userInfo, setUserInfo] = useState<any>(null)
  const router = useRouter()

  useEffect(() => {
    const checkAuth = async () => {
      const authData = getAuthInfo()
      
      if (!authData || !authData.password) {
        router.push('/admin/login')
        return
      }

      // èªè¨¼æƒ…å ±ã®æœ‰åŠ¹æ€§ã‚’ç¢ºèª
      try {
        const response = await fetch('/api/admin/auth/verify', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${authData.password}`
          }
        })

        if (response.ok) {
          setIsAuthenticated(true)
          setUserInfo(authData)
        } else {
          localStorage.removeItem('authData')
          router.push('/admin/login')
        }
      } catch (error) {
        console.error('èªè¨¼ç¢ºèªã‚¨ãƒ©ãƒ¼:', error)
        router.push('/admin/login')
      }
      
      setLoading(false)
    }

    checkAuth()
  }, [router])

  const logout = () => {
    localStorage.removeItem('authData')
    router.push('/admin/login')
  }

  return { isAuthenticated, loading, userInfo, logout }
}
```

#### 2. èªè¨¼ç¢ºèªAPIã®ä½œæˆ
`src/app/api/admin/auth/verify/route.ts`:
```typescript
import { NextRequest, NextResponse } from 'next/server'
import { checkAdminAuth } from '../../drawings/route'

export async function POST(request: NextRequest) {
  if (checkAdminAuth(request)) {
    return NextResponse.json({ success: true })
  }
  return NextResponse.json({ error: 'èªè¨¼å¤±æ•—' }, { status: 401 })
}
```

#### 3. ç®¡ç†ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ä½œæˆ
`src/app/admin/layout.tsx`:
```typescript
'use client'

import { useAdminAuth } from '@/hooks/useAdminAuth'

export default function AdminLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const { isAuthenticated, loading, userInfo, logout } = useAdminAuth()

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
          <p className="mt-4 text-gray-600">èªè¨¼ç¢ºèªä¸­...</p>
        </div>
      </div>
    )
  }

  if (!isAuthenticated) {
    return null
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <header className="bg-white shadow-sm border-b">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between items-center h-16">
            <h1 className="text-xl font-semibold">ç®¡ç†ç”»é¢</h1>
            <div className="flex items-center space-x-4">
              <span className="text-sm text-gray-600">
                ãƒ­ã‚°ã‚¤ãƒ³ä¸­: {userInfo?.name || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼'}
              </span>
              <button
                onClick={logout}
                className="text-sm text-red-600 hover:text-red-700"
              >
                ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
              </button>
            </div>
          </div>
        </div>
      </header>
      
      {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
      <main className="py-8">
        {children}
      </main>
    </div>
  )
}
```

---

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

1. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã®ç®¡ç†**
   - `passwords.json`ã¯å¿…ãš`.gitignore`ã«è¿½åŠ 
   - æœ¬ç•ªç’°å¢ƒã§ã¯åˆ¥ã®å®‰å…¨ãªå ´æ‰€ã«é…ç½®
   - å®šæœŸçš„ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã‚’æ¨å¥¨

2. **æœ¬ç•ªç’°å¢ƒã§ã®æ³¨æ„**
   - å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
   - HTTPSã§ã®é‹ç”¨å¿…é ˆ
   - ç’°å¢ƒå¤‰æ•°ã¯çµ¶å¯¾ã«å…¬é–‹ã—ãªã„
   - NASä¸Šã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚‹å ´åˆã¯ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’é©åˆ‡ã«è¨­å®š

3. **å°†æ¥çš„ãªæ”¹å–„æ¡ˆ**
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆbcryptç­‰ï¼‰
   - JWT ãƒˆãƒ¼ã‚¯ãƒ³ã®å°å…¥
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æœŸé™è¨­å®š
   - ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´ã®è¨˜éŒ²
   - IPã‚¢ãƒ‰ãƒ¬ã‚¹åˆ¶é™

---

## ğŸ“‚ å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆ/
â”œâ”€â”€ .env.local                          # ç’°å¢ƒå¤‰æ•°è¨­å®š
â”œâ”€â”€ .gitignore                          # passwords.jsonã‚’è¿½åŠ 
â”œâ”€â”€ public/
â”‚   â””â”€â”€ data/
â”‚       â””â”€â”€ auth/
â”‚           â””â”€â”€ passwords.json          # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆGitç®¡ç†å¤–ï¼‰
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx              # ç®¡ç†ç”»é¢å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆæ–°è¦ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx            # ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ï¼ˆæ–°è¦ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx                # ç®¡ç†ç”»é¢ãƒˆãƒƒãƒ—
â”‚   â”‚   â”‚   â””â”€â”€ drawings/
â”‚   â”‚   â”‚       â”œâ”€â”€ new/page.tsx        # æ–°è¦ç™»éŒ²ï¼ˆè¦ä¿®æ­£ï¼‰
â”‚   â”‚   â”‚       â”œâ”€â”€ list/page.tsx       # ä¸€è¦§ï¼ˆè¦ä¿®æ­£ï¼‰
â”‚   â”‚   â”‚       â””â”€â”€ [id]/
â”‚   â”‚   â”‚           â””â”€â”€ edit/page.tsx   # ç·¨é›†ï¼ˆè¦ä¿®æ­£ï¼‰
â”‚   â”‚   â””â”€â”€ api/
â”‚   â”‚       â””â”€â”€ admin/
â”‚   â”‚           â”œâ”€â”€ auth/
â”‚   â”‚           â”‚   â”œâ”€â”€ login/
â”‚   â”‚           â”‚   â”‚   â””â”€â”€ route.ts    # ãƒ­ã‚°ã‚¤ãƒ³APIï¼ˆæ–°è¦ï¼‰
â”‚   â”‚           â”‚   â””â”€â”€ verify/
â”‚   â”‚           â”‚       â””â”€â”€ route.ts    # èªè¨¼ç¢ºèªAPIï¼ˆæ–°è¦ï¼‰
â”‚   â”‚           â””â”€â”€ drawings/
â”‚   â”‚               â””â”€â”€ route.ts        # checkAdminAuthé–¢æ•°æ”¹ä¿®
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ auth/
â”‚   â”‚       â””â”€â”€ client.ts               # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆèªè¨¼ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆæ–°è¦ï¼‰
â”‚   â””â”€â”€ hooks/
â”‚       â””â”€â”€ useAdminAuth.ts             # èªè¨¼çŠ¶æ…‹ç®¡ç†ãƒ•ãƒƒã‚¯ï¼ˆæ–°è¦ï¼‰
```

---

## ğŸ“Š å®Ÿè£…å·¥æ•°è¦‹ç©ã‚‚ã‚Š

| ãƒ•ã‚§ãƒ¼ã‚º | å†…å®¹ | è¦‹ç©æ™‚é–“ | å„ªå…ˆåº¦ |
|---------|------|----------|--------|
| Phase 1 | æ—¢å­˜å•é¡Œã®ä¿®æ­£ + èªè¨¼åŸºç›¤æ•´å‚™ | 1æ™‚é–“ | å¿…é ˆ |
| Phase 2 | ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢è¿½åŠ  | 1.5æ™‚é–“ | æ¨å¥¨ |
| Phase 3 | ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† | 1æ™‚é–“ | æ¨å¥¨ |

**åˆè¨ˆ**: ç´„3.5æ™‚é–“

---

## ğŸ¯ æœ€å°å®Ÿè£…

æ€¥ãã®å ´åˆã¯ã€Phase 1ã®ã¿å®Ÿè£…ã™ã‚Œã°æœ€ä½é™ã®èªè¨¼ã¯æ©Ÿèƒ½ã—ã¾ã™ï¼š

1. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã¨ç’°å¢ƒå¤‰æ•°è¨­å®š
2. checkAdminAuthé–¢æ•°ã®æ”¹ä¿®ï¼ˆå¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œï¼‰
3. ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸ`'admin123'`ã‚’ä¿®æ­£
4. æ—¢å­˜ç”»é¢ã§ã®APIå‘¼ã³å‡ºã—ã«èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼è¿½åŠ 

ã“ã‚Œã ã‘ã§ã‚‚ã€åŸºæœ¬çš„ãªèªè¨¼æ©Ÿèƒ½ã¨ã—ã¦å‹•ä½œã—ã¾ã™ã€‚

### èªè¨¼ãƒ•ãƒ­ãƒ¼ã®è©³ç´°

```
è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œç‰ˆ:
1. ç®¡ç†ç”»é¢URLï¼ˆ/admin/*ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›
3. ã‚µãƒ¼ãƒãƒ¼å´ã§passwords.jsonã¨ç…§åˆ
4. èªè¨¼æˆåŠŸæ™‚ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’localStorageã«ä¿å­˜
5. ä»¥é™ã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã§è‡ªå‹•çš„ã«èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ä»˜ä¸

ç°¡æ˜“ç‰ˆï¼ˆpromptä½¿ç”¨ï¼‰:
1. ç®¡ç†ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«prompt()ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›
2. å…¥åŠ›ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’localStorageã«ä¿å­˜
3. APIãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«è‡ªå‹•çš„ã«ä½¿ç”¨
```

### å®Ÿè£…ã®é¸æŠè‚¢

| é …ç›® | ç°¡æ˜“ç‰ˆ | æ¨å¥¨ç‰ˆ |
|------|--------|---------|
| ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ | prompt() | å°‚ç”¨ç”»é¢ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼è­˜åˆ¥ | ãªã— | ãƒ¦ãƒ¼ã‚¶ãƒ¼åè¡¨ç¤º |
| UI/UX | æœ€å°é™ | æ´—ç·´ã•ã‚ŒãŸãƒ‡ã‚¶ã‚¤ãƒ³ |
| å®Ÿè£…æ™‚é–“ | 1æ™‚é–“ | 3.5æ™‚é–“ |

---

## ğŸ“ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### âœ… Phase 1ï¼ˆåŸºæœ¬å®Ÿè£…ï¼‰- å®Œäº†
- [x] passwords.jsonãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
- [x] .gitignoreã«passwords.jsonã‚’è¿½åŠ 
- [x] .env.localã«èªè¨¼è¨­å®šã‚’è¿½åŠ 
- [x] checkAdminAuthé–¢æ•°ã®æ”¹ä¿®ï¼ˆå¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œï¼‰
- [x] èªè¨¼ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆclient.tsï¼‰ã®ä½œæˆ
- [x] AdminAuthCheckã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

### âœ… Phase 2ï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ï¼‰- å®Œäº†
- [x] ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®ä½œæˆ
- [x] ãƒ­ã‚°ã‚¤ãƒ³APIã®å®Ÿè£…
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤ºï¼ˆç®¡ç†ç”»é¢ãƒˆãƒƒãƒ—ï¼‰
- [x] ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½

### âœ… Phase 3ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ï¼‰- å®Œäº†
- [x] ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æœŸé™ï¼ˆ2æ™‚é–“ï¼‰
- [x] æœ€çµ‚ã‚¢ã‚¯ã‚»ã‚¹æ™‚åˆ»ã®æ›´æ–°æ©Ÿèƒ½
- [x] è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½

### âœ… Phase 4ï¼ˆå…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰- å®Œäº†
- [x] ç®¡ç†ç”»é¢å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆlayout.tsxï¼‰ã®ä½œæˆ
- [x] å„ç®¡ç†ç”»é¢ã‹ã‚‰ãƒ˜ãƒƒãƒ€ãƒ¼å‰Šé™¤
- [x] çµ±ä¸€ã•ã‚ŒãŸãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

### ğŸ“‹ Phase 5ï¼ˆAPIèªè¨¼ï¼‰- æœªå®Ÿè£…
- [ ] å„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã®èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ä»˜ä¸
- [ ] APIå‘¼ã³å‡ºã—æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´7æœˆ23æ—¥  
**ä½œæˆè€…**: Claude Code  
**æ‰¿èªè€…**: æœªå®š